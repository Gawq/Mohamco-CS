# 0. 프로세스와 스레드

프로세스는 컴퓨터에서 실행되고 있는 프로그램을 말하며 CPU 스케줄링의 대상이 되는 작업이라는 용어와 같은 의미로 쓰인다.
스레드는 프로세스 내 작업의 흐름을 지칭한다.

# 1. 프로세스와 컴파일 과정

프로세스는 프로그램으로부터 인스턴스화된 것을 말한다.

## 전처리

소스 코드의 주석을 제거하고 헤더 파일을 병합해 매크로를 치환

## 컴파일러

오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환

## 어셈블러

어셈블리어는 목적 코드로 변환된다.

## 링커

프로그램 내에 있는 랑비ㅡ러리 함수 또는 다른 파일들과 목적 코드를 결합해 실행 파일을 만든다.

# 2. 프로세스의 상태

프로세스는 여러 상태 값을 갖고 있다.

## 생성 상태

프로세스가 생성된 상태. fork() 또는 exec()를 통해 생성한다 이 때 PCB가 할당된다.

### fork()

부모 프로세스의 주소 공간을 그대로 복사해 자식 프로세스를 생성한다.

### exec()

새롭게 프로세스를 생성하는 함수이다.

## 대기 상태

메모리 공간이 충분하면 할당받고 아니면 대기한다.
CPU 스케줄러부터 소유권이 넘어오기를 기다리는 상태

## 대기 중단 상태

메모리 부족으로 인해 임시 중단된 상태

## 실행 상태

CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태
이를 CPU burst가 일어났다고도 표현함

## 중단 상태

어떤 이벤트가 발생한 이후 기다리며 프로세스가 차단된 상태
IO에 의한 인터럽트로 이런 현상이 발생하기도 한다.

## 임시 중단 상태

대기 중단과 과 유사한데 중단된 상태에서 프로세스를 실행하려고 했지만 메모리 부족으로 다시 중단된 상태

## 종료 상태

메모리와 CPU 소유권을 모두 놓고 가는 상태

# 3. 프로세스의 메모리 구조

운영체제는 프로세스에 적절한 메모리를 할당하는데 다음 구조를 기반으로 할당한다.

## 스택

스택에는 지역변수, 매개변수, 함수가 저장되며 동적인 특징이 있다.
스택 영역은 함수가 함수를 재귀적으로 호출하면서 동적으로 크기간 ㅡㄹ어날 수 있는데 이때 힙과 스택의 메모리 영역이 겹치면 안되기에 그 사이의 고간을 비워 놓은다.

## 힙

힙은 동적 할당할 때 사용되며 런타임 시 크기가 결정된다.

## 데이터 영역

데이터 영역에는 전역변수, 정적변수가 저장되고 정적인 특징이 있다.

## 코드 영역

코드 영역은 프로그램에 내장되어 있는 소스 코드가 들어가있는 영역이다.
수정 불가능한 기계어로 되어 있으며 정적인 특징이 있다.

# 4. PCB

운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터를 말하며 프로세스 제어 블록이라고도 한다.

## PCB 구조

- 프로세스 스케줄링 상태
- 프로세스 ID
- 프로세스 권한
- 프로그램 카운터
- CPU 레지스터
- CPU 스케줄링 정보
- 계정 정보
- I/O 상태 정보

## 컨텍스트 스위칭

컨텍스트 스위칭은 PCB를 교환하는 과정을 말한다.

컴퓨터는 많은 프로그램을 동시에 실행하는 것처럼 보이지만 실행되고 있는 프로세스는 단 한개이다. 동시에 구동되는 것 처럼 보이기 위해 다른 프로세스와의 컨텍스트 스위칭이 아주 빠르게 실행되고 있기 때문이다.

하지만 멀티코어의 CPU를 가지고 있기에 위의 설명은 반은 맞고 반은 틀리다.
그래서 여기서는 싱글코어를 기준으로 설명한다.

한 갠의 프로세스 A가 실행하다 멈추고 프로세스 A의 PCB를 저장
다시 프로세스 B를 로드하여 실행한다. 반대로 한번 더 실행한다.

이 컨텍스트 스위칭이 일어날 때 마다 유휴 시간이 발생하고 비용도 드는데 이를 캐시미스라고 한다.

### 캐시미스

컨텍스트 스위칭이 일어날 때 프로세스가 갖고 있는 메모리 주소가 그대로면 잘못된 주소 변환이 생기므로 캐시클리어 과정을 겪고 이 때문에 캐시미스가 발생한다.

# 5. 멀티프로세세싱

멀티프로세싱은 여러 개의 프로세스로 인해 동시에 두가지 이상의 일을 수행할 수 있는 것을 뜻한다. 이를 통해 하나 이상의 일을 병렬로 처리할 수 있고 문제가 발생되더라도 다른 프로세스를 이용해 처리할 수 있기에 신뢰성이 높다.

## 웹 브라우저

웹 브라우저는 멀티프로세스 구조를 갖고 있다.

- 브라우저 프로세스
- 렌더러 프로세스
- 플러그인 프로세스
- GPU 프로세스

## IPC

멀티프로세스는 IPC가 가능하며 IPC는 프로세스간 데이터를 주고받고 공유 데이터를 관리하는 메커니즘을 뜻한다.
클라와 서버로 예를 들면 클라가 데이터 요청하면 서버가 응답하는 것이 IPC의 예이다.

ICP의 종류

- 공유 메모리
- 파일
- 소켓
- 익명 파이프
- 명명 파이프
- 메시지 큐

# 6. 스레드와 멀티스레딩

## 스레드

스레드는 프로세스의 실행 가능한 가장 작은 단위다. 프로세스는 여러 스레드를 가질 수 있다.

코드, 데이터, 스택, 힙을 각각 생성하는 프로세스와는 달리
스레드는 코드, 데이터, 힙은 스레드끼리 서로 공유한다.

## 멀티스레딩

멀티스레딩은 프로세스 내 작업을 멀티스레드로 처리하는 기법이며 스레드끼리 자원을 공유하기에 호율성이 높다.

리소스가 적고 한 스레드가 중단되어도 다른 스레드는 실행 상태일 수 있기에 중단되지 않은 빠른 처리가 가능하다.
하지만 한 스레드에 문제가 생기면 공유성으로 인해 다른 스레드에도 영향이 간다.

# 7. 공유 자원과 임계 영역

## 공유 자원

공유 자원은 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 모니터, 메모리, 파일 등의 자원이나 변수 등을 의미한다.
이 공유 자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰는 상황을 경쟁 상태라고 한다. 동시에 접근을 시도할 때 접근 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태인 것이다.

## 임계 영역

임계 영역은 스레드가 공유 자원에 접근시 순서 등의 이유로 결과가 달라지는 코드 영역을 말한다.
이를 해결하기 위한 방법은 뮤텍스, 세마포어, 모니터가 있으며 이 방법 모두 상호 배제, 한정 대기, 융통성이란 조건을 만족한다.
이 방법들의 토대가 되는 매커니즘은 잠금이다.

# 8. 교착 상태

교착 상태는 두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태를 말한다.

## 교착 상태의 원인

- 상호 배제 : 한 프로세스가 자원을 독점하고 있으며 다른 프로세스 접근 불가
- 점유 대기 : 특정 프로세스가 점유한 자원을 다른 프로세스가 요청한 상태
- 비선점 : 다른 프로세스의 자원을 강제적으로 가져올 수 없음
- 환형 대기 : 서로가 서로의 자원을 요구하는 상황

## 교착 상태의 해결 방법

1. 자원을 할당할 때 애초에 조건이 성립되지 않도록 설계한다.
2. 교착 상태 가능성이 없을 때만 자원 할당되며, 은행원 알고리즘을 써 할당 가능 여부를 판단한다.
3. 교착 상태가 발생하면 사이클을 찾아보고 관련된 프로세스를 한 개씩 지운다.
4. 교착 상태를 처리하는 방법이 더 크기에 사용자가 작업을 종료한다. 응답없음을 표하는 것이다.
