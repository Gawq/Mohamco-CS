### 인터넷 프로토콜 스위트 (Internet protocol suite)
: 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 **프로토콜의 집합**
이를 <U>TCP/IP 4계층 모델</U>로 설명하거나 OSI 7계층 모델로 설명하기도 한다.

- TCP/IP 4계층 모델
	- 네트워크에서 사용되는 통신 프로토콜의 집합
	- 계층들은 프로토콜의 네트워킹 범위에 따라 4개의 추상화 계층으로 구성된다.


### TCP/IP (TransmissionControl Protocol / Internet Protocol)
-   인터넷 통신의 기반이 되는 프로토콜로 이를 이용해 컴퓨터를 연결하는 체계를 이더넷(Ethernet)이라 한다.


## 1.1. 계층 구조 비교
![[Pasted image 20230109171901.png]]

### TCP/IP 4계층
-   `1 Layer : Network Access` or Network Interface Layer _(네트워크 액세스 계층)_
	- OSI 7계층의 물리계층과 데이터 링크 계층에 해당하며 물리적인 주소로 MAC 사용
	- LAN, 패킷망 등

-   `2 Layer : Internet Layer` _(인터넷 계층)_
	- OSI 7계층의 네트워크 계층에 해당하며 통신 노드 간의 IP패킷을 전송하는 기능과 라우팅 기능 담당
	- IP, ARP, RARP 등

-   `3 Layer : Transport Layer` _(전송 계층)_
	- OSI 7계층의 전송 계층에 해당하며 통신 노드 간의 연결을 제어하고, 신뢰성 있는 데이터 전송 담당
	- TCP, UDP 등

-   `4 Layer : Application Layer` _(응용 계층)
	- OSI 7계층의 세션 계층, 표현 계층, 응용 계층에 해당하며 TCP/UDP 기반의 응용 프로그램을 구현할 때 사용합니다.
	- FTP, HTTP, SSH 등


### OSI 7계층
컴퓨터 네트워크 프로토콜 디자인과 통신을 계층으로 나눈다.
-   `1 Layer : Physical` _(물리 계층)_
    -   역할 : 실제 장치들을 연결하기 위해 필요한 전기적, 물리적 세부 사항들을 정의
    -   PDU : 비트(Bit)
    -   프로토콜 : Modem, Cable, Fiber, RS-232C
    -   관련 장비 : 리피터, 허브

-   `2 Layer : Data link` _(데이터 링크 계층)_
    -   역할 : 포인트 투 포인트(Point to Point) 간 신뢰성 있는 전송을 보장한다. 송수신 속도 차이를 해결하기 위한 흐름 제어와 프레임 동기화 등의 역할을 한다.
    -   PDU : 프레임(Frame)
    -   프로토콜 : 이더넷, MAC, PPP, ATM, LAN, Wifi
    -   관련 장비 : 랜카드, 브릿지, 스위치

-   `3 Layer : Network` _(네트워크 계층)_
    -   역할 : 여러 개의 노드를 거칠 때마다 경로를 찾아준다.
    -   PDU : 패킷(Packet)
    -   프로토콜 : IP, ICMP 등
    -   관련 장비 : 라우터, L3 스위치

-   `4 Layer : Transport` _(전송 계층)_
    -   역할 : 양 끝단(End to end)의 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해준다. 헤드에는 세그먼트가 포함되며 주소 설정, 오류 및 흐름 제어, 다중화를 수행한다.
    -   PDU : 세그먼트(Segment)
    -   프로토콜 : TCP, UDP , ARP, RTP
    -   관련 장비 : 게이트웨이, L4 스위치

-   `5 Layer : Session` _(세션 계층)_
    -   역할 : 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다.
    -   PDU : 메세지(Message)
    -   프로토콜 : NetBIOS, SSH, TLS

-   `6 Layer : Presentation` _(표현 계층)_
    -   역할 : 표현계층은 송신측과 수신측 사이에서 데이터의 형식(png, jpg, jpeg...)을 정한다. 받은 데이터를 코드 변환, 구문 검색, 암호화, 압축의 과정을 통해 올바른 표준방식으로 변환해준다.
    -   PDU : 메세지(Message)
    -   프로토콜 : JPG, MPEG, SMB, AFP

-   `7 Layer : Application` _(응용 계층)_
    -   역할 : 응용 프로세스와 직접 관계하여 일반적인 응용 서비스 수행
    -   PDU : 메세지(Message)
    -   프로토콜 : HTTP, SMTP, SNMP, FTP, Telnet, SSH & Scp, NFS, RTSP

- PDU(Protocol Data Unit) : 프로토콜 데이터 단위
    -   계층이 전달한 데이터에 붙이는 제어 정보
    -   데이터는 동일하나 Layer를 거치면서 헤더 정보가 갱신되며 이름이 달라진다. 사용자는 Data로, TCP는 Segment, IP는 Packet와 같다.

### TCP/IP 계층과 OSI 계층 차이
- 애플리케이션 계층 : TCP/IP 계층과 달리 OSI 계층은 3개(애플리케이션, 프레젠테이션, 세션 계층)로 쪼갰다.
- 링크 계층 :  TCP/IP 계층과 달리 OSI 계층은 2개(데이터 링크, 물리 계층)로 나눠서 표현했다.
- TCP/IP 계층의 인터넷 계층, OSI 계층의 네트워크 계층

### 공통점
이 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 **유연하게** 설계되었다.
- 예시
	- 전송 계층에서 TCP를 UDP로 변경했다고 해서 인터넷 웹 브라우저를 다시 설치해야하는 것이 아니다.



## 1.2. TCP/IP 4계층
![[Pasted image 20230109172528.png]]
각 계층을 대표하는 스택


### 4계층 - 애플리케이션 (application) 계층
---
>웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 프로토콜 계층

- FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용된다.


- FTP : 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜
- HTTP : WWW(World Wide Web)을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
- SSH : 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
- SMTP : 전자 메일 전송을 위한 인터넷 통신 프로토콜
- DNS : 도메인 이름과 IP 주소를 매핑해주는 서버
	- 예시 (www.naver.com에 DNS 쿼리가 올 때)
		- [Root DNS] -> [.com DNS] -> [.naver DNS] -> [.www DNS] 과정을 거쳐 완벽한 주소를 찾아 IP 주소를 매핑한다.
		- IP 주소가 바뀌어도 사용자들에게 똑같은 도메인 주소로 서비스가 가능한 것이다.
			- 예를 들어, www.naver.com의 IP 주소가 222.111.222.111에서 222.111.222.122로 바뀌었음에도 똑같은 www.naver.com이라는 주소로 서비스 가능



### 3계층 - 전송 (Transport) 계층
---
> 송신자와 수신자를 연결하는 통신 서비스 제공

- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때의 중계 역할
- TCP, UDP 등 해당


### TCP
- 패킷 사이의 순서 보장 
- 연결지향 프로토콜을 사용해서 연결 -> 신뢰성을 구축해서 수신 여부를 확인
- `가상회선 패킷 교환 방식` 사용
	- 각 패킷에는 가상회선 식별자가 포함된다. 모든 패킷을 전송하면 가상회선이 해제되고, **패킷들은 어떠한 회선을 따라 전송된 '순서대로' 도착하는 방식**
	- ![[Pasted image 20230109174302.png]]


### UDP
- 순서 보장 x
- 수신 여부 확인 x
- `데이터그램 패킷 교환 방식` 사용 (단순히 데이터만 전송)
	- 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 간다. 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있어 **도착한 '순서가 다를 수 있는' 방식**
	- ![[Pasted image 20230109174435.png]]
	- 3,2,1로 이루어진 패킷이 순서가 다르며, 어떠한 회선을 중심으로 가는 것이 아닌 따로 이동하며 순서도 다르게 도착하는 것을 볼 수 있다.


### `TCP` 와 `UDP` 의 차이점은 ?

- TCP(Stateful, 상태유지)는 신뢰성이 있는 연결, UDP(Stateless, 무상태)는 빠른 전송을 지향하는 프로토콜이다.
- TCP는 내가 보낸 데이터가 확실히 상대방에게 전달이 되었는지 포커를 맺고, UDP는 일방적으로 전송을 한다.
- UDP는 알고리즘이 간단한 반면, TCP는 연결부터 끊는 과정까지 상대적으로 복잡하다.
- UDP의 한 예로 스트리밍 방송이 있는데, 방송을 하다가 중간에 신호가 끊어져도 다음으로 그냥 이어서 방송을 하는 것처럼 UDP는 일방적인 데이터 전송을 하는 반면, TCP는 데이터 하나라도 놓치지 않고 완벽히 보내는 것이 목표이기 때문에 방향성이 완전히 다르다.



### 2.1. TCP 연결 성립 과정  (3-way handshake)
---
TCP가 신뢰성 확보할 때 **`3-웨이 핸드셰이크(3-way handshake)`** 작업 진행


클라이언트-서버 간 통신 과정
![[Pasted image 20230109174659.png]]

1. 클라이언트 -> 서버 : SYN 단계 (요청)
	- 클라이언트는 서버에 클라이언트의 <U>ISN</U>을 담아 SYN 전송
2. 서버 -> 클라이언트 : SYN + ACK 단계
	- 서버는 클라이언트의 SYN 수신 -> 서버의 ISN 전송 (승인번호로 클라이언트의 ISN + 1을 보낸다)
3. 클라이언트 -> 서버 : ACK 단계 (응답)
	- 클라이언트는 승인번호(서버의 ISN + 1한 값)를 담아 -> ACK를 서버에 전송

-> 3-way handshake 과정 이후 **신뢰성이 구축**되고 데이터 전송 시작


> TCP를 신뢰성이 있는 계층이라고 하는 이유는 ?
> 	3-way handshake 과정이 있기 때문이다.
> 	UDP는 이 과정이 없으므로 신뢰성이 없는 계층이라고 한다.


> SYN (SYNchronization) : 연결 요청 플래그
> ACK (ACKnowledgement) : 응답 플래그
> ISN (Initial Sequence Numbers) : 초기 네트워크 연결 시 할당된 32비트 고유 시퀀스 번호
	- 사진의 12010이 해당하며, 이는 장치마다 다를 수 있다.




### 2.1.2. TCP 연결 해제 과정 (4-way handshake)
---
TCP가 연결 해제할 때 `4-way handshake` 과정 발생

![[Pasted image 20230109185041.png]]

1. 클라이언트 -> 서버 : FIN
	- 클라이언트가 연결 닫으려고 할 때, `FIN`으로 설정된 세그먼트 전송
	- 클라이언트 : `FIN_WAIT_1` 상태에 들어간다. (서버의 응답을 기다린다.)
2. 서버 -> 클라이언트 : ACK
	- 서버가 클라이언트에게 `ACK`(승인 세그먼트) 전송
	- 서버 : `CLOSE_WAIT` 상태
	- 클라이언트 : 세그먼트를 받으면 `FIN_WAIT_2` 상태
3. 서버 -> 클라이언트 : FIN
	- 서버가 `ACK` 전송 -> 일정 시간 이후, 클라이언트에 `FIN` 세그먼트 전송
4. 클라이언트 -> 서버 : ACK
	- 클라이언트 : `TIME_WAIT` 상태 -> 다시 서버로 `ACK` 전송 -> 서버 : `CLOSED` 상태 -> 클라이언트는 어느 정도 시간 대기 후, 연결 닫힘 -> 클라이언트와 서버의 모든 자원의 연결 해제

> 상태 정보
> -   `CLOSED`: 포트가 닫힌 상태
> -  `LISTEN`: 포트가 열린 상태로 연결 요청 대기 중
> -   `SYN-RECEIVED`: SYN 요청을 받고 상대방의 응답 기다리는 중
> -   `ESTABLISHED`: 포트 연결 상태
> -   `TIME_WAIT`: 클라이언트는 서버로부터 FIN을 수신하더라도 일정시간 동안 세션을 남겨놓고 받지 못한 패킷을 기다리는 것



### TIME_WAIT
---
: 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태
지연 패킷, 연결 닫힘 확인 등의 문제점을 해결하는데 사용
(OS마다 다를 수 있다. (CentOS6, 우분투 : 60s, 윈도우: 4m))

### 왜 연결을 일정 시간 뒤에 닫을까?

1. 지연 패킷이 발생할 경우를 대비하기 위해서
	- 패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 <U>데이터 무결성</U> 문제가 발생한다.
		- 데이터 무결성 (data integrity) : 데이터의 정확성과 일관성을 유지하고 보증하는 것
2. 두 장치가 연결이 닫혔는지 확인하기 위해서
	- LAST_ACK 상태에서 닫힌다면 ?
		- 다시 새로운 연결을 하려고 할 때, 장치는 줄곧 LAST_ACK로 되어 있기 때문에 접속 오류가 나타난다.

이러한 이유로 **TIME_WAIT**라는 잠시 기다릴 시간이 필요하다.



### 2계층 - 인터넷 (Internet) 계층
---
> 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층

- 패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달
- 비연결형적 특징을 가진다. (상대방이 제대로 수신했는지에 대해 보장하지 않는 것)
- IP, ARP, ICMP 등 해당


### 2.1.3. 링크 계층 (== 네트워크 접근 계층)
---
> 전선, 광섬유, 무선 등 **실질적으로 데이터 전달**하며, 장치 간 신호를 주고 받는 **규칙**을 정하는 계층

링크 계층을 두 가지로 나누기도 한다.
- 물리 계층
- 데이터 링크 계층 (이더넷 프레임)
	- **이더넷 프레임**을 통한 에러 확인, 흐름 제어, 접근 제어 담당 계층


### 링크 계층 - 물리 계층
---
> 무선 LAN과 <U>유선 LAN</U>을 통해 0과 1로 이루어진 데이터를 보내는 계층

### 유선 LAN(IEEE802.3)
유선 LAN을 이루는 이더넷은 IEEE802.3이라는 프로토콜을 따르며 <U>전이중화 통신</U>을 사용한다.

### 전이중화 (full duplex) 통신
양쪽 장치가 동시에 송수신할 수 있는 방식
![[Pasted image 20230109191818.png]]
- 송신로와 수신로로 나눠 데이터를 주고받는다.
- 현대의 고속 이더넷 통신 방식


이전 방식 CSMA/CD
유선 LAN의  `반이중화 통신` 방식 중 하나로, Carrier Sense Multiple Access with Collision Detection 약어
- 데이터를 ‘보낸 이후’ 충돌이 발생한다면 일정 시간 이후 재전송하는 방식
- 이는 수신로와 송신로를 각각 둔 것이 아니고 한 경로를 기반으로 데이터를 보내기 때문에 데이터를 보낼 때 충돌에 대해 대비해야 했기 때문이다.



### 유선 LAN를 이루는 케이블
1. 트위스트 페어 케이블
	- == TP 케이블
	- 하나의 케이블처럼 보이지만 실제로 여덟 개의 구리선을 두 개씩 꼬아 묶은 케이블
2. 광섬유 케이블
	- 광섬유로 만든 케이블
	- 레이저를 이용해서 통신 -> 구리선과는 비교할 수 없을 만큼의 장거리 및 고속 통신 가능
	- 보통 100Gbps의 데이터를 전송
	- 광섬유 내부와 외부를 다른 밀도를 가지는 유리나 플라스틱 섬유로 제작해서 한 번 들어간 빛이 내부에서 계속적으로 반사하며 전진하여 반대편 끝까지 가는 원리 이용

- 케이블 종류
	- UTP 케이블 (== LAN 케이블)
		- 구리선을 실드 처리하지 않고 덮는다.
		- RJ-45 커넥터 (LAN 케이블을 꽂을 수 있는 커넥터)
	- STP 케이블


### 무선 LAN(IEEE802.11)
무선 LAN 장치는  `반이중화 통신` 사용
수신과 송신에 같은 채널을 사용하기 때문이다.

### 반이중화 (half duplex) 통신
양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한 번에 한 방향만 통신할 수 있는 방식
![[Pasted image 20230110083218.png]]
- 장치가 신호를 수신하기 시작하면 응답하기 전에 전송이 완료될 때까지 기다려야 한다.
- 충돌 방지 시스템 필요
	- 둘 이상의 장치가 동시에 전송하면 충돌이 발생하여 메시지가 손실되거나 왜곡될 수 있기 때문이다.

CSMA/CA
: 반이중화 통신 중 하나로, 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식 사용
1. 데이터를 송신하기 전에 무선 매체를 살핀다.
2. 캐리어 감지: 회선이 비어 있는지를 판단한다.
3. IFS(Inter FrameSpace): 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다린다.
4. 이후에 데이터를 송신한다.

> 전이중화 통신과 반이중화 통신의 차이
> 전이중화 통신은 양방향 통신이 가능하므로 충돌 가능성이 없기 때문에 충돌을 감지하거나 방지하는 메커니즘이 필요하지 않다.


### 무선 LAN 을 이루는 주파수
---
> 무선 LAN(WLAN, Wireless Local Area Network) : 무선 신호 전달 방식을 이용하여 2대 이상의 장치를 연결하는 기술
- 비유도 매체인 공기에 주파수를 쏘아 무선 통신망을 구축
- 주파수 대역 : 2.4GHz 대역 또는 5GHz 대역 (보통 5GHz 사용 권장)
	- 2.4GHz : 장애물에 강한 특성을 가지고 있지만 전자레인지, 무선 등 전파 간섭이 일어나는 경우가 많다.
	- 5GHz : 사용할 수 있는 채널 수도 많고 동시에 사용할 수 있기 때문에 상대적으로 깨끗한 전파 환경을 구축할 수 있다.

1. 와이파이 (wifi)
> 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
- 이를 사용하려면 무선 접속 장치(AP, Access Point)가 있어야 한다. 
- 흔히 이를 공유기라고 하며, 이를 통해 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔주어 신호가 닿는 범위 내에서 무선 인터넷을 사용할 수 있게 된다. 
- 무선 LAN을 이용한 기술로는 와이파이만 있는 것이 아니고 지그비, 블루투스 등이 있다.


2. BSS (Basic Service Set)
> 기본 서비스 집합을 의미하며, 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조

- 근거리 무선 통신 제공
- 하나의 AP만을 기반으로 구축이 되어 있어 사용자가 한 곳에서 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는 것은 불가능하다.

3. ESS (Extended Service Set)
 > 하나 이상의 연결된 BSS 그룹
 
- 장거리 무선 통신 제공
- BSS보다 더 많은 가용성과 이동성 지원
- 즉, 사용자는 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크에 계속 연결할 수 있다.

![[Pasted image 20230110084309.png]]


4. 이더넷 프레임
> 데이터 링크 계층은 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화하며 다음과 같은 구조를 가진다.

![[Pasted image 20230110084358.png]] 
- Preamble: 이더넷 프레임이 시작임을 알린다.
• SFD(Start Frame Delimiter): 다음 바이트부터 MAC 주소 필드가 시작됨을 알린다.
• DMAC, SMAC: 수신, 송신 MAC 주소
• EtherType: 데이터 계층 위의 계층인 IP 프로토콜을 정의 (IPv4 또는 IPv6)
• Payload: 전달받은 데이터
• CRC: 에러 확인 비트
- MAC 주소 : 컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치(LAN 카드)가 있는데, 이를 구별하기 위한 식별번호를 말한다. 6바이트(48비트)로 구성된다.


## 2.1.4. 계층 간 데이터 송수신 과정
---
컴퓨터를 통해 다른 컴퓨터로 데이터를 요청한다면 어떠한 일이 일어날까? 예를 들어 HTTP를 통해 웹 서버에 있는 데이터를 요청한다면? 다음과 같은 일이 발생한다.

![[Pasted image 20230110084555.png]]

과정
1. 애플리케이션 계층에서 전송 계층으로 필자가 보내는 요청(request) 값들이 캡슐화 과정을 거쳐 전달
2. 다시 링크 계층을 통해 해당 서버와 통신
3. 해당 서버의 링크 계층으로부터 애플리케이션까지 비캡슐화 과정을 거쳐 데이터가 전송된다.


### 캡슐화 과정 (Encapsulation)
> 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
> 어떤 네트워크를 통과하기 위해 전송하려는 데이터를 다른 무언가로 감싸서 보내고 해당 네트워크를 통과하면 감싼 부분을 다시 벗겨내어 전송하는 기능
- 데이터에 제어 정보를 덧붙이는 것

![[Pasted image 20230110084656.png]]
과정 : 세그먼트, 데이터그램화 -> 패킷화 -> 프레임화
- 애플리케이션 계층의 데이터가 전송 계층으로 전달되면서 `세그먼트` 또는 `데이터그램`화되며 TCP(L4) 헤더가 붙여지게 된다.
- 이후 인터넷 계층으로 가면서 IP(L3) 헤더가 붙여지게 되며 `패킷`화가 된다.
- 이후 링크 계층으로 전달되면서 프레임 헤더와 프레임 트레일러가 붙어 `프레임`화가 된다.


### 비캡슐화 과정
> 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정

![[Pasted image 20230110084821.png]]
과정 : 프레임화된 데이터 -> 패킷화 -> 세그먼트, 데이터그램화 -> 메시지화
- 캡슐화된 데이터를 받게 되면 링크 계층에서부터 타고 올라온다.
- 프레임화된 데이터는 다시 패킷화를 거쳐 세그먼트, 데이터그램화를 거쳐 메시지화가 되는 비캡슐화 과정이 일어난다.
- 이후 최종적으로 사용자에게 애플리케이션의 PDU인 메시지로 전달된다.



## 2.2. PDU (Protocol Data Unit)
---
> 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위
> 프로토콜 데이터 단위, 각 계층의 데이터 단위
- 데이터 통신에서 상위 계층이 전달한 데이터에 붙이는 제어정보

![[Pasted image 20230110095410.png]]

구성 (계층마다 부르는 명칭이 다르다.)
1. 제어 관련 정보들이 포함된 ‘헤더’
2. 데이터를 의미하는 ‘페이로드’

- 애플리케이션 계층: 메시지 Message(Data)
- 전송 계층: 세그먼트 Segment (TCP), 데이터그램(UDP)
- 인터넷 계층: 패킷 Packets
- 링크 계층: 프레임 Frame (데이터 링크 계층), 비트 Bit (물리 계층)

애플리케이션 계층은 ‘메시지’를 기반으로 데이터를 전달하는데, HTTP의 헤더가 문자열인 것이 그 예이다.

PDU 중 아래 계층인 **비트**로 송수신하는 것의 장점 
 - 모든 PDU 중 가장 빠르고 효율성이 높다.
 - 그러나 애플리케이션 계층에서는 문자열을 기반으로 송수신을 하는데, 그 이유는 헤더에 authorization 값 등 다른 값들을 넣는 확장이 쉽기 때문이다.




## 2.3. 네트워크 기기
---
네트워크는 여러 개의 네트워크 기기를 기반으로 구축된다.

## 2.3.1 네트워크 기기의 처리 범위

**계층별** 처리 범위
- 애플리케이션 계층 : L7 스위치
- 인터넷 계층 : 라우터, L3 스위치
- 데이터 링크 계층 : 브리지, L2 스위치
- 물리 계층 : NIC, 리피터, AP
	- 스위치 : 여러 장비를 연결하고 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기 신호를 보내 데이터를 전송하는 통신 네트워크 장비

상위 계층을 처리하는 기기는 하위 계층을 처리할 수 있지만 그 반대는 불가하다. 
예를 들어 L7 스위치는 애플리케이션 계층을 처리하는 기기로, 그 밑의 모든 계층의 프로토콜을 처리할 수 있다. 하지만 AP는 물리 계층밖에 처리하지 못한다.


## 2.3.2. 애플리케이션 계층 처리 기기
---
상위 계층으로 갈수록 더욱 정교한 로드밸런싱이 가능하다.

### L7 스위치 == 로드밸런서
---
> 서버의 부하를 분산하는 기기로, 클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 한다.
- 시스템이 처리할 수 있는 트래픽 증가를 목표로 한다.

특징, 기능
- URL, 서버, 캐시, 쿠키들을 기반으로 트래픽 분산
- 바이러스, 불필요한 외부 데이터 등을 걸러내는 필터링 기능
- 응용 프로그램 수준의 트래픽 모니터링도 가능

만약 장애가 발생한 서버가 있다면 이를 트래픽 분산 대상에서 제외해야 하는데, 이는 정기적으로 <U>헬스 체크(health check)</U>를 이용하여 감시하면서 이루어진다.

### 헬스 체크
: 전송 주기와 재전송 횟수 등을 설정한 이후 반복적으로 서버에 요청을 보내는 것
-  L4 스위치 또는 L7 스위치 모두 헬스 체크를 통해 정상적인 서버 또는 비정상적인 서버를 판별한다.
- 서버에 부하가 되지 않을 만큼 요청 횟수가 적절해야 한다. 
- TCP, HTTP 등 다양한 방법으로 요청을 보내며 이 요청이 정상적으로 이루어졌다면 정상적인 서버로 판별한다. 
	- 예를 들어 TCP 요청을 보냈는데 3-웨이 핸드셰이크가 정상적으로 일어나지 않았다면 정상이 아닌 것이다.


로드밸런서의 종류
- L4 스위치
- L7 스위치
부하 분산에는 L4 로드밸런서와 L7 로드밸런서가 가장 많이 활용된다. 그 이유는 L4 로드밸런서부터 포트(Port)정보를 바탕으로 로드를 분산하는 것이 가능하기 때문이다. 한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야만 한다.

### L4 스위치와 L7 스위치 차이
![[Pasted image 20230110102244.png]]


L4 스위치
- 인터넷 계층을 처리하는 기기
- 스트리밍 관련 서비스에서는 사용할 수 없다.
- 메시지를 기반으로 인식하지 못하고 IP와 포트를 기반으로(특히 포트를 기반으로) 트래픽을 분산한다.

L7 로드밸런서
- IP, 포트 외에도 URL, HTTP 헤더, 쿠키 등을 기반으로 트래픽을 분산한다.

+ 클라우드 서비스(AWS 등) 스위치 이용
	+ L7 스위치를 이용한 로드밸런싱은 ALB (Application Load Balancer) 컴포넌트로 한다.
	+ L4 스위치를 이용한 로드밸런싱은 NLB (Network Load Balancer) 컴포넌트로 한다.


### 로드밸런서를 이용한 서버 이중화
-   서버를 분배하는 로드 밸런서에 문제가 생길 수 있기 때문에 로드 밸런서를 이중화하여 대비한다.
- 2대 이상의 서버를 가상의 IP를 제공하여 이를 기반으로 안정적인 서비스 제공


## 2.3.3. 인터넷 계층 처리 기기
---

### 라우터 (router)
> 여러 개의 네트워크 연결, 분할, 구분시켜주는 <U>라우팅</U> 장비
- 라우팅 : 다른 네트워크에 존재하는 장치끼리 서로 데이터를 주고받을 때 패킷 소모를 최소화하고 경로를 최적화하여 최소 경로로 패킷을 포워딩
- 소프트웨어 기반의 라우팅
- 하드웨어 기반의 라우팅 - L3 스위치가 담당

### L3 스위치
> L2 스위치 기능 + 라우팅 기능 갖춘 장비로, 라우터라고 해도 무방하다.


## 2.3.4. 데이터 계층 처리 기기
---

### L2 스위치
> 장치들의 MAC 주소를 MAC 주소 테이블을 통해 관리,
> 연결된 장치로부터 패킷이 왔을 때 패킷 전송 담당

- IP 주소 기반으로 라우팅 불가능 (IP 주소를 이해하지 못하므로)
- 단순히 패킷의 MAC 주소를 읽어 스위칭하는 역할
- 목적지가 MAC 주소 테이블에 없다면 전체 포트에 전달하고 MAC 주소 테이블의 주소는 일정 시간 이후 삭제하는 기능


### 브리지 (bridge)
> 두 개의 근거리 통신망(LAN)을 상호 접속할 수 있도록 하는 통신망 연결 장치
- 포트와 포트 사이의 다리 역할
- 장치에서 받아온 MAC 주소를 MAC 주소 테이블로 관리한다.
- 통신망 범위를 확장하고 서로 다른 LAN 등으로 이루어진 ‘하나의’ 통신망을 구축할 때 쓰인다.


## 2.3.5. 물리 계층 처리 기기
---

### NIC
> LAN 카드라고 하는 네트워크 인터페이스 카드(NIC, Network Interface Card)는 2대 이상의 컴퓨터 네트워크를 구성하는 데 사용하며, 네트워크와 빠른 속도로 데이터를 송수신할 수 있도록 컴퓨터 내에 설치하는 확장 카드
- 각 LAN 카드에는 주민등록번호처럼 각각을 구분하기 위한 고유의 식별번호인 MAC 주소 존재

### 리피터 (repeater)
> 들어오는 약해진 신호 정도를 증폭하여 다른 쪽으로 전달하는 장치
- 패킷이 더 멀리 갈 수 있게 한다.
- 광케이블이 보급됨에 따라 현재는 잘 쓰이지 않는 장치

### AP (Access Point)
> 패킷 복사 기기
- AP에 유선 LAN을 연결한 후 -> 다른 장치에서 무선 LAN 기술(와이파이 등)을 사용하여 무선 네트워크 연결 가능
